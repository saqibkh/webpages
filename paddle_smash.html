<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Paddle Smash</title>
<style>
html, body {
  margin: 0; padding: 0; overflow: hidden;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #4CAF50, #81C784);
  height: 100%; width: 100%;
}
h1 {
  position: absolute; top: 20px; width: 100%;
  text-align: center; color: white;
  font-size: 2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); z-index:5;
}
canvas {
  display:block; width:90vw; height:70vh; margin:auto;
  position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
  background: #222; border:4px solid #333; border-radius:12px;
}
#overlay, #level-overlay, #pause-overlay {
  position:absolute; top:0; left:0; width:100%; height:100%;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  color:white; font-size:2em; z-index:10;
}
#overlay, #level-overlay { background: rgba(0,0,0,0.7); display:none; }
#pause-overlay { background: rgba(0,0,0,0.5); display:none; font-size:3em; }
#overlay button, #level-overlay button {
  margin-top:20px; padding:10px 20px; font-size:1em; border:none;
  border-radius:8px; background:#4CAF50; color:white; cursor:pointer;
}
#overlay button:hover, #level-overlay button:hover { background:#43a047; }
#level-overlay select { font-size:0.8em; padding:5px 10px; margin-top:20px; border-radius:6px; border:none; }
#highscores-container { margin-top:20px; text-align:center; font-size:0.8em; }
#score-tab {
  position:absolute; top:10px; right:10px; z-index:20;
  background:rgba(0,0,0,0.6); padding:5px 10px; border-radius:6px; color:white;
  font-size:0.8em; width:100px; overflow:hidden; transition:width 0.3s;
}
#score-tab:hover { width:250px; }
#score-tab select { font-size:0.8em; padding:3px 5px; margin-top:5px; border-radius:4px; border:none; }
#scores-display {
  margin-top:5px; max-height:0; overflow:hidden;
  transition:max-height 0.4s ease, opacity 0.4s ease; opacity:0; white-space:nowrap;
}
#score-tab:hover #scores-display { max-height:300px; opacity:1; white-space:normal; }

#timer {
  position: absolute;
  top: 70px;
  width: 100%;
  text-align: center;
  color: white;
  font-size: 1.5em;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
  z-index: 5;
}

footer {
  position: absolute;
  bottom: 10px;
  width: 100%;
  text-align: center;
  font-size: 14px;
  color: rgba(255,255,255,0.7);
  z-index: 50;
}
footer a {
  color: rgba(255,255,255,0.85);
  text-decoration: none;
  transition: color 0.3s;
}
footer a:hover {
  color: #fff;
  text-decoration: underline;
}
</style>
</head>
<body>
<h1>Paddle Smash</h1>
<div id="timer">00:00</div>
<canvas id="gameCanvas"></canvas>

<!-- Score Tab -->
<div id="score-tab">
  <label for="view-level">View Scores:</label>
  <select id="view-level">
    <option value="1">Level 1</option><option value="2">Level 2</option>
    <option value="3">Level 3</option><option value="4">Level 4</option>
    <option value="5">Level 5</option><option value="6">Level 6</option>
    <option value="7">Level 7</option><option value="8">Level 8</option>
    <option value="9">Level 9</option><option value="10">Level 10</option>
  </select>
  <div id="scores-display">No scores yet.</div>
</div>

<!-- Overlays -->
<div id="overlay">
  <div id="gameover-text">Game Over</div>
  <div id="final-score"></div>
  <div id="highscores-container"></div>
  <button onclick="restartGame()">Restart</button>
</div>
<div id="level-overlay">
  <div>Select Level (1-10):</div>
  <select id="level-select">
    <option value="1">1 (Slowest)</option><option value="2">2</option><option value="3">3</option>
    <option value="4">4</option><option value="5">5</option><option value="6">6</option>
    <option value="7">7</option><option value="8">8</option><option value="9">9</option>
    <option value="10">10 (Fastest)</option>
  </select>
  <button onclick="startGame()">Start Game</button>
</div>
<div id="pause-overlay">Paused</div>

<audio id="paddle-sound" src="../assets/sounds/paddle_hit.mp3" preload="auto"></audio>
<audio id="block-sound" src="../assets/sounds/block_hit.wav" preload="auto"></audio>

<footer>
  <a href="https://github.com/sponsors/saqibkh" target="_blank">‚ù§Ô∏è Support the developer on GitHub</a>
</footer>

<!-- ‚úÖ Firebase setup -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs,
    query, where, orderBy, limit
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

  // üîß Replace this with your Firebase project configuration:
  const firebaseConfig = {
    apiKey: "AIzaSyApRYbtteQa7lMkC09N2VZb2hoQLIPWB70",
    authDomain: "paddle-smash-khansaqib.firebaseapp.com",
    projectId: "paddle-smash-khansaqib",
    storageBucket: "paddle-smash-khansaqib.firebasestorage.app",
    messagingSenderId: "834494575151",
    appId: "1:834494575151:web:abdb9dc6e1d8f84e96ccda"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.saveScoreOnline = async function (level, name, score, time) {
    await addDoc(collection(db, "scores"), { level, name, score, time, created: Date.now() });
  };

  window.getHighScores = async function (level) {
    const q = query(
      collection(db, "scores"),
      where("level", "==", level),
      orderBy("score", "desc"),
      orderBy("time", "asc"),
      limit(10)
    );
    const snap = await getDocs(q);
    return snap.docs.map(d => d.data());
  };
</script>

<!-- ‚úÖ Game logic -->
<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
const overlay=document.getElementById("overlay");
const finalScore=document.getElementById("final-score");
const levelOverlay=document.getElementById("level-overlay");
const levelSelect=document.getElementById("level-select");
const pauseOverlay=document.getElementById("pause-overlay");
const highscoresContainer=document.getElementById("highscores-container");
const viewLevelSelect=document.getElementById("view-level");
const scoresDisplay=document.getElementById("scores-display");

const paddleSound=document.getElementById("paddle-sound");
const blockSound=document.getElementById("block-sound");

let animationId;
let paddle={width:100,height:12,x:0,y:0,speed:0};
let ball={x:0,y:0,radius:10,dx:0,dy:0,released:false};
let baseSpeed=0;
const blockRows=5,blockCols=8,blockHeight=20,blockPadding=10,blockOffsetTop=30,blockOffsetLeft=35;
let blocks=[],blockWidth;
let score=0,gameOver=false,gameWon=false,startTime=null,level=1,paused=false;
let particles=[];
let timerInterval=null,elapsedSeconds=0;

function formatTime(seconds){const m=Math.floor(seconds/60).toString().padStart(2,'0');const s=(seconds%60).toString().padStart(2,'0');return `${m}:${s}`;}
function startTimer(){clearInterval(timerInterval);elapsedSeconds=0;document.getElementById("timer").textContent=formatTime(elapsedSeconds);timerInterval=setInterval(()=>{elapsedSeconds++;document.getElementById("timer").textContent=formatTime(elapsedSeconds);},1000);}
function stopTimer(){clearInterval(timerInterval);}
function initParticles(){particles=[];for(let i=0;i<50;i++){particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,radius:Math.random()*2+1,dx:(Math.random()-0.5),dy:(Math.random()-0.5)});}}
function initBlocks(){blocks=[];blockWidth=(canvas.width-blockOffsetLeft*2-blockPadding*(blockCols-1))/blockCols;for(let r=0;r<blockRows;r++){blocks[r]=[];for(let c=0;c<blockCols;c++){blocks[r][c]={x:0,y:0,status:1,row:r};}}}
function resizeCanvas(){canvas.width=canvas.clientWidth;canvas.height=canvas.clientHeight;paddle.y=canvas.height-25;paddle.x=canvas.width/2-paddle.width/2;if(!ball.released){ball.x=paddle.x+paddle.width/2;ball.y=paddle.y-ball.radius;}initBlocks();initParticles();}
window.addEventListener('resize',resizeCanvas);resizeCanvas();levelOverlay.style.display="flex";

function startGame(){
  level=parseInt(levelSelect.value);
  paddle.width=200*Math.pow(0.98,level-1);
  paddle.x=canvas.width/2-paddle.width/2;
  levelOverlay.style.display="none";
  gameOver=false;gameWon=false;score=0;startTime=null;
  ball.released=false;ball.dx=0;ball.dy=0;
  baseSpeed=2+level;
  cancelAnimationFrame(animationId);
  initBlocks();initParticles();
  animationId=requestAnimationFrame(draw);
}

canvas.addEventListener("mousemove",e=>{const r=canvas.getBoundingClientRect();paddle.x=e.clientX-r.left-paddle.width/2;if(paddle.x<0)paddle.x=0;if(paddle.x+paddle.width>canvas.width)paddle.x=canvas.width-paddle.width;if(!ball.released){ball.x=paddle.x+paddle.width/2;ball.y=paddle.y-ball.radius;}});
canvas.addEventListener("click",()=>{launchBall();});
document.addEventListener("keydown",e=>{if(e.key==="ArrowLeft")paddle.speed=-7;else if(e.key==="ArrowRight")paddle.speed=7;else if(e.key.toLowerCase()==="p"){paused=!paused;pauseOverlay.style.display=paused?"flex":"none";}else if(e.key===" "&&!ball.released&&!gameOver)launchBall();});
document.addEventListener("keyup",e=>{if(e.key==="ArrowLeft"||e.key==="ArrowRight")paddle.speed=0;});

function launchBall(){if(!ball.released&&!gameOver){ball.released=true;ball.dx=baseSpeed;ball.dy=-baseSpeed;if(!startTime)startTime=Date.now();startTimer();}}
function playSound(s){s.currentTime=0;s.play();}
function drawPaddle(){ctx.fillStyle="#4CAF50";ctx.fillRect(paddle.x,paddle.y,paddle.width,paddle.height);}
function drawBall(){ctx.beginPath();ctx.arc(ball.x,ball.y,ball.radius,0,Math.PI*2);ctx.fillStyle="#FF5722";ctx.fill();ctx.closePath();}
function drawBlocks(){for(let r=0;r<blockRows;r++){for(let c=0;c<blockCols;c++){let b=blocks[r][c];if(b.status){let bx=blockOffsetLeft+c*(blockWidth+blockPadding);let by=blockOffsetTop+r*(blockHeight+blockPadding);b.x=bx;b.y=by;let g=ctx.createLinearGradient(bx,by,bx+blockWidth,by+blockHeight);g.addColorStop(0,`hsl(${r*60},70%,50%)`);g.addColorStop(1,`hsl(${r*60+30},90%,60%)`);ctx.fillStyle=g;ctx.fillRect(bx,by,blockWidth,blockHeight);ctx.strokeStyle="#000";ctx.strokeRect(bx,by,blockWidth,blockHeight);}}}}
function drawParticles(){for(let p of particles){ctx.beginPath();ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);ctx.fillStyle="rgba(255,255,255,0.5)";ctx.fill();ctx.closePath();p.x+=p.dx;p.y+=p.dy;if(p.x<0||p.x>canvas.width)p.dx*=-1;if(p.y<0||p.y>canvas.height)p.dy*=-1;}}
function drawBallTrail(){ctx.beginPath();ctx.arc(ball.x-ball.dx,ball.y-ball.dy,ball.radius*0.9,0,Math.PI*2);ctx.fillStyle="rgba(255,87,34,0.5)";ctx.fill();ctx.closePath();}

function draw(){
  if(paused||gameOver){animationId=requestAnimationFrame(draw);return;}
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawParticles();drawBlocks();drawPaddle();drawBallTrail();drawBall();
  paddle.x+=paddle.speed;
  if(paddle.x<0)paddle.x=0;if(paddle.x+paddle.width>canvas.width)paddle.x=canvas.width-paddle.width;
  if(ball.released){
    ball.x+=ball.dx;ball.y+=ball.dy;
    if(ball.x+ball.radius>canvas.width||ball.x-ball.radius<0)ball.dx*=-1;
    if(ball.y-ball.radius<0)ball.dy*=-1;
    if(ball.dy>0&&ball.y+ball.radius>=paddle.y&&ball.y-ball.dy+ball.radius<=paddle.y+paddle.height&&ball.x+ball.radius>paddle.x&&ball.x-ball.radius<paddle.x+paddle.width){
      ball.y=paddle.y-ball.radius;ball.dy=-Math.abs(ball.dy);playSound(paddleSound);
    }
    for(let r=0;r<blockRows;r++){for(let c=0;c<blockCols;c++){let b=blocks[r][c];if(b.status&&ball.x>b.x&&ball.x<b.x+blockWidth&&ball.y>b.y&&ball.y<b.y+blockHeight){ball.dy*=-1;b.status=0;score++;playSound(blockSound);if(score===blockRows*blockCols){gameWon=true;endGame();}}}}
    if(ball.y-ball.dy-ball.radius>canvas.height){gameOver=true;endGame();}
  }
  animationId=requestAnimationFrame(draw);
}

async function endGame(){
  ball.released=false;overlay.style.display="flex";
  finalScore.innerText="Score: "+score;
  stopTimer();
  let time=Math.floor((Date.now()-startTime)/1000);
  await saveScore(level,score,time);
}

function restartGame(){overlay.style.display="none";levelOverlay.style.display="flex";document.getElementById("timer").textContent="00:00";}

// --- Firebase-based High Scores ---
async function saveScore(level,score,time){
  const playerName = prompt("üéÆ You made the top 10! Enter your name:", "Player") || "Player";
  await saveScoreOnline(level,playerName,score,time);
  await displayHighScores(level);
  await updateScoreTab(level);
}
async function displayHighScores(level){
  const scores = await getHighScores(level);
  if(!scores.length){highscoresContainer.innerHTML="<p>No high scores yet.</p>";return;}
  let html=`<h3>Top 10 Scores (Level ${level})</h3><ol>`;
  scores.forEach(s=>{html+=`<li>${s.name}: Score ${s.score} | Time: ${s.time}s</li>`;});
  html+="</ol>";highscoresContainer.innerHTML=html;
}
async function updateScoreTab(level){
  const scores = await getHighScores(level);
  if(!scores.length){scoresDisplay.innerHTML="No high scores yet.";return;}
  let html="<ol>";
  scores.forEach(s=>{html+=`<li>${s.name}: ${s.score} pts | ${s.time}s</li>`;});
  html+="</ol>";scoresDisplay.innerHTML=html;
}

window.onload = () => {
  updateScoreTab(parseInt(viewLevelSelect.value));
  viewLevelSelect.addEventListener("change",async()=>{
    await updateScoreTab(parseInt(viewLevelSelect.value));
  });
};

</script>
</body>
</html>

